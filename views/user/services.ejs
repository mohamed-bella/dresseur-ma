<style>
     body {
          background-color: #f0f0ef !important;
     }
</style>
<%- include('include/head.ejs', { user }) %>
     <%- include('include/navbar.ejs', { user }) %>

          <!-- Category Navigation -->
          <nav class="sticky top-16 z-40 bg-white/95 backdrop-blur-md border-b border-gray-200">
               <div class="max-w-7xl mx-auto px-4">
                    <!-- Desktop Navigation -->
                    <div class="hidden md:flex justify-between items-center py-2">
                         <div class="flex gap-4">
                              <% const servicesTab=[ { id: 'tous' , icon: 'üîç' , label: 'Tous' , bgColor: 'gray' }, { id: 'dressage' , icon: 'üêï' , label: 'Dressage' , bgColor: 'blue' }, { id: 'toilettage' , icon: '‚úÇÔ∏è' , label: 'Toilettage' , bgColor: 'purple' }, { id: 'promenade' , icon: 'ü¶Æ' , label: 'Promenade' , bgColor: 'green' }, { id: 'veterinaire' , icon: '‚öïÔ∏è' , label: 'V√©t√©rinaire' , bgColor: 'red' }, { id: 'pension' , icon: 'üè†' , label: 'Pension' , bgColor: 'orange' }, { id: 'transport' , icon: 'üöó' , label: 'Transport' , bgColor: 'indigo' } ] %>

                                   <% servicesTab.forEach(service=> { %>
                                        <a href="/services/<%= service.id %>" class="group relative px-6 py-2.5 rounded-xl transition-all duration-200
                                 <%= serviceOption === service.id ? 
                                     `bg-${service.bgColor}-50 text-${service.bgColor}-600 shadow-sm scale-105` : 
                                     'text-gray-600 hover:bg-gray-50' %>">
                                             <div class="flex items-center gap-2">
                                                  <span class="text-xl group-hover:scale-110 transition-transform duration-200">
                                                       <%= service.icon %>
                                                  </span>
                                                  <span class="font-medium">
                                                       <%= service.label %>
                                                  </span>
                                             </div>
                                             <% if (serviceOption===service.id) { %>
                                                  <div class="absolute inset-x-0 -bottom-3 h-0.5 bg-<%= service.bgColor %>-600"></div>
                                                  <% } %>
                                        </a>
                                        <% }) %>
                         </div>
                    </div>

                    <!-- Mobile Navigation -->
                    <div class="md:hidden relative">
                         <div class="overflow-x-auto scrollbar-hide py-3">
                              <div class="flex gap-3 snap-x snap-mandatory">
                                   <% servicesTab.forEach(service=> { %>
                                        <a href="/services/<%= service.id %>" class="flex-none first:pl-4 last:pr-4 snap-start
                                     <%= serviceOption === service.id ? 
                                         `bg-${service.bgColor}-50 text-${service.bgColor}-600 shadow-md` : 
                                         'bg-white text-gray-600' %>
                                     p-3 rounded-xl active:scale-95 transform transition-all">
                                             <div class="flex flex-col items-center gap-1 min-w-[4rem]">
                                                  <span class="text-2xl">
                                                       <%= service.icon %>
                                                  </span>
                                                  <span class="text-xs font-medium whitespace-nowrap">
                                                       <%= service.label %>
                                                  </span>
                                             </div>
                                        </a>
                                        <% }) %>
                              </div>
                         </div>

                         <!-- Scroll Shadows -->
                         <div class="pointer-events-none absolute inset-y-0 left-0 w-16 bg-gradient-to-r from-white"></div>
                         <div class="pointer-events-none absolute inset-y-0 right-0 w-16 bg-gradient-to-l from-white"></div>
                    </div>
               </div>
          </nav>

          <style>
               .scrollbar-hide {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
               }

               .scrollbar-hide::-webkit-scrollbar {
                    display: none;
               }

               .snap-x {
                    scroll-snap-type: x mandatory;
               }

               .snap-start {
                    scroll-snap-align: start;
               }
          </style>

          <style>
               /* Enhance touch scrolling */
               .scrollbar-hide {
                    scrollbar-width: none;
                    -ms-overflow-style: none;
                    -webkit-overflow-scrolling: touch;
               }

               .scrollbar-hide::-webkit-scrollbar {
                    display: none;
               }

               /* Smooth snap scrolling */
               .snap-x {
                    scroll-snap-type: x mandatory;
                    scroll-padding-left: 1rem;
               }

               .snap-start {
                    scroll-snap-align: start;
               }

               /* Active state animations */
               .scale-105 {
                    transform: scale(1.05);
               }

               .active\:scale-95:active {
                    transform: scale(0.95);
               }

               /* Enhanced touch feedback */
               @media (hover: none) {
                    .active\:scale-95:active {
                         transform: scale(0.95);
                         opacity: 0.9;
                    }
               }

               /* Smooth transitions */
               .transition-all {
                    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
               }

               /* Prevent overscroll bounce */
               .overscroll-x-contain {
                    overscroll-behavior-x: contain;
               }

               /* Active tab indicator animation */
               .h-0.5 {
                    transition: transform 0.2s ease;
               }

               /* Hover animations for icons */
               .group:hover .group-hover\:scale-110 {
                    transform: scale(1.1);
               }

               /* Better focus states */
               a:focus-visible {
                    outline: 2px solid #3B82F6;
                    outline-offset: 2px;
               }

               /* Loading skeleton animation */
               @keyframes shimmer {
                    0% {
                         transform: translateX(-100%)
                    }

                    100% {
                         transform: translateX(100%)
                    }
               }

               .animate-shimmer::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg,
                              transparent,
                              rgba(255, 255, 255, 0.3),
                              transparent);
                    animation: shimmer 1.5s infinite;
               }
          </style>

          <script>
               document.addEventListener('DOMContentLoaded', function () {
                    const scrollContainer = document.querySelector('.overflow-x-auto');
                    const activeTab = document.querySelector('[class*="scale-105"]');

                    // Scroll active tab into view on load
                    if (activeTab) {
                         setTimeout(() => {
                              activeTab.scrollIntoView({
                                   behavior: 'smooth',
                                   block: 'nearest',
                                   inline: 'center'
                              });
                         }, 100);
                    }

                    // Add momentum scrolling for iOS
                    let startX;
                    let scrollLeft;
                    let isDown = false;
                    let velocity = 0;
                    let rafId;

                    scrollContainer.addEventListener('touchstart', (e) => {
                         isDown = true;
                         startX = e.touches[0].pageX - scrollContainer.offsetLeft;
                         scrollLeft = scrollContainer.scrollLeft;
                         cancelAnimationFrame(rafId);
                    }, { passive: true });

                    scrollContainer.addEventListener('touchend', () => {
                         isDown = false;
                         // Apply momentum scrolling
                         function momentumScroll() {
                              if (Math.abs(velocity) > 0.1) {
                                   scrollContainer.scrollLeft += velocity;
                                   velocity *= 0.95;
                                   rafId = requestAnimationFrame(momentumScroll);
                              }
                         }
                         momentumScroll();
                    }, { passive: true });

                    scrollContainer.addEventListener('touchmove', (e) => {
                         if (!isDown) return;
                         e.preventDefault();
                         const x = e.touches[0].pageX - scrollContainer.offsetLeft;
                         const walk = (x - startX) * 2;
                         const prevScroll = scrollContainer.scrollLeft;
                         scrollContainer.scrollLeft = scrollLeft - walk;
                         velocity = scrollContainer.scrollLeft - prevScroll;
                    });

                    // Add haptic feedback for supported devices
                    const buttons = document.querySelectorAll('a');
                    buttons.forEach(button => {
                         button.addEventListener('click', () => {
                              if ('vibrate' in navigator) {
                                   navigator.vibrate(5);
                              }
                         });
                    });
               });
          </script>


          <!-- Services List Container -->
          <div class="container mx-auto px-4 py-6">
               <!-- Page Header -->
               <div class="text-center mt-3 mb-8">
                    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">
                         Services disponibles
                         <% if (serviceOption) { %>
                              - <%= serviceOption.charAt(0).toUpperCase() + serviceOption.slice(1) %>
                                   <% } %>
                    </h1>
                    <!-- <p class="text-gray-600 max-w-2xl mx-auto">
                         D√©couvrez les meilleurs prestataires de services animaliers pr√®s de chez vous
                    </p> -->
               </div>

               <!-- Location Filter Section -->
               <div class="relative mb-8">
                    <div class="flex items-center justify-between mb-4">
                         <h2 class="text-lg font-semibold text-gray-900 px-4">Choisissez votre ville</h2>
                         <!-- Mobile scroll indicators -->
                         <div class="sm:hidden flex items-center gap-1">
                              <div class="w-2 h-2 rounded-full bg-blue-500"></div>
                              <div class="w-2 h-2 rounded-full bg-gray-200"></div>
                              <div class="w-2 h-2 rounded-full bg-gray-200"></div>
                         </div>
                    </div>

                    <!-- Mobile Slider -->
                    <div class="sm:hidden relative">
                         <div class="flex overflow-x-auto scrollbar-hide snap-x snap-mandatory gap-2 pb-4" id="locationSlider">
                              <% locations.forEach(location=> { %>
                                   <a href="/services/<%= serviceOption %>/<%= encodeURIComponent(location) %>" class="flex-none snap-start first:ml-4 last:mr-4">
                                        <div class="flex items-center px-4 py-2.5 rounded-full text-sm whitespace-nowrap
                                            bg-white text-gray-700 border border-gray-200 shadow-sm
                                            active:bg-blue-50 active:text-blue-600 active:border-blue-100
                                            <%= (currentLocation === location) ? 'bg-blue-50 text-blue-600 border-blue-200' : '' %>">
                                             <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5 <%= (currentLocation === location) ? 'text-blue-500' : 'text-gray-400' %>" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                             </svg>
                                             <%= location.charAt(0).toUpperCase() + location.slice(1) %>
                                        </div>
                                   </a>
                                   <% }); %>
                         </div>
                    </div>

                    <!-- Desktop View -->
                    <div class="hidden sm:flex flex-wrap items-center gap-2 px-4">
                         <% locations.forEach(location=> { %>
                              <a href="/services/<%= serviceOption %>/<%= encodeURIComponent(location) %>" class="inline-flex items-center px-4 py-2.5 rounded-full text-sm font-medium
                                    bg-white text-gray-700 hover:text-blue-600 border border-gray-200
                                    hover:border-blue-100 hover:bg-blue-50 shadow-sm
                                    transition-all duration-200 
                                    <%= (currentLocation === location) ? 'bg-blue-50 text-blue-600 border-blue-200' : '' %>">
                                   <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5 <%= (currentLocation === location) ? 'text-blue-500' : 'text-gray-400' %>" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                   </svg>
                                   <%= location.charAt(0).toUpperCase() + location.slice(1) %>
                              </a>
                              <% }); %>
                    </div>
               </div>

               <!-- Services Grid -->
               <% if (services && services.length> 0) { %>
                    <div class="grid grid-cols-1 gap-4">
                         <% services.forEach(service=> { %>
                              <a href="/service/<%= service._id %>" class="block group">
                                   <!-- Mobile Design -->
                                   <div class="sm:hidden bg-white rounded-xl shadow-sm overflow-hidden">
                                        <div class="flex">
                                             <!-- Image Left -->
                                             <div class="w-32 h-32 relative flex-shrink-0">
                                                  <% if (service.images?.[0]) { %>
                                                       <img src="<%= service.images[0] %>" alt="" class="w-full h-full object-cover">
                                                       <% } else { %>
                                                            <div class="w-full h-full bg-gray-100 flex items-center justify-center">
                                                                 <i class="fas fa-image text-gray-400 text-2xl"></i>
                                                            </div>
                                                            <% } %>
                                                                 <!-- Service Type Badge -->
                                                                 <div class="absolute top-2 left-2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-full text-xs font-medium">
                                                                      <%= serviceIcons[service.serviceOptions]?.emoji || 'üêæ' %>
                                                                 </div>
                                             </div>

                                             <!-- Content Right -->
                                             <div class="flex-1 p-3">
                                                  <div class="flex justify-between items-start">
                                                       <h3 class="font-semibold text-gray-900 mb-1 line-clamp-1">
                                                            <%= service.serviceName || service.serviceOptions %>
                                                       </h3>
                                                       <span class="text-sm font-bold text-gray-900">
                                                            <%= service.priceRange || 'Sur devis' %>
                                                       </span>
                                                  </div>

                                                  <!-- Location & Views -->
                                                  <div class="flex items-center gap-2 text-xs text-gray-500 mb-2">
                                                       <i class="fas fa-map-marker-alt"></i>
                                                       <span>
                                                            <%= service.location || 'Non sp√©cifi√©' %>
                                                       </span>
                                                       <span>‚Ä¢</span>
                                                       <span>
                                                            <%= service.views %> vues
                                                       </span>
                                                  </div>

                                                  <!-- Provider -->
                                                  <div class="flex items-center gap-2">
                                                       <img src="<%= service.createdBy?.profileImage || '/default-avatar.png' %>" class="w-6 h-6 rounded-full object-cover" alt="">
                                                       <span class="text-xs font-medium text-gray-700 truncate">
                                                            <%= service.createdBy?.displayName || 'Service Provider' %>
                                                                 <% if (service.createdBy?.isVerified) { %>
                                                                      <i class="fas fa-check-circle text-blue-500 ml-1"></i>
                                                                      <% } %>
                                                       </span>
                                                  </div>
                                             </div>
                                        </div>
                                   </div>

                                   <!-- Desktop Design -->
                                   <div class="hidden sm:block bg-white rounded-xl shadow-sm hover:shadow-md transition-all overflow-hidden">
                                        <div class="flex">
                                             <!-- Image Section -->
                                             <div class="w-48 relative">
                                                  <% if (service.images?.[0]) { %>
                                                       <img src="<%= service.images[0] %>" class="w-full h-full object-cover" loading="lazy" alt="">
                                                       <% } else { %>
                                                            <div class="w-full h-full bg-gray-100 flex items-center justify-center">
                                                                 <i class="fas fa-image text-gray-400 text-3xl"></i>
                                                            </div>
                                                            <% } %>

                                                                 <!-- Service Badge -->
                                                                 <div class="absolute top-3 left-3 bg-white/90 backdrop-blur-sm px-3 py-1.5 rounded-full">
                                                                      <div class="flex items-center gap-2">
                                                                           <span class="text-base">
                                                                                <%= serviceIcons[service.serviceOptions]?.emoji || 'üêæ' %>
                                                                           </span>
                                                                           <span class="text-sm font-medium text-gray-700">
                                                                                <%= service.serviceOptions %>
                                                                           </span>
                                                                      </div>
                                                                 </div>
                                             </div>

                                             <!-- Content Section -->
                                             <div class="flex-1 p-6">
                                                  <div class="flex justify-between items-start mb-4">
                                                       <div>
                                                            <h3 class="text-xl font-semibold text-gray-900 group-hover:text-blue-600 transition-colors">
                                                                 <%= service.serviceName || service.serviceOptions %>
                                                            </h3>
                                                            <p class="text-sm text-gray-500 mt-1">
                                                                 <i class="fas fa-map-marker-alt mr-1"></i>
                                                                 <%= service.location || 'Non sp√©cifi√©' %>
                                                                      <span class="mx-2">‚Ä¢</span>
                                                                      <%= service.views %> vues
                                                            </p>
                                                       </div>
                                                       <div class="text-right">
                                                            <div class="text-xl font-bold text-gray-900">
                                                                 <%= service.priceRange || 'Sur devis' %>
                                                            </div>
                                                            <div class="text-xs text-gray-500">par s√©ance</div>
                                                       </div>
                                                  </div>

                                                  <!-- Provider Section -->
                                                  <div class="flex items-center justify-between mt-4 pt-4 border-t">
                                                       <div class="flex items-center gap-3">
                                                            <img src="<%= service.createdBy?.profileImage || '/default-avatar.png' %>" class="w-10 h-10 rounded-full object-cover" alt="">
                                                            <div>
                                                                 <div class="font-medium">
                                                                      <%= service.createdBy?.displayName || 'Service Provider' %>
                                                                           <% if (service.createdBy?.isVerified) { %>
                                                                                <i class="fas fa-check-circle text-blue-500 ml-1"></i>
                                                                                <% } %>
                                                                 </div>
                                                                 <div class="text-sm text-gray-500">Pro</div>
                                                            </div>
                                                       </div>
                                                       <div class="text-blue-600 group-hover:translate-x-1 transition-transform">
                                                            <i class="fas fa-arrow-right"></i>
                                                       </div>
                                                  </div>
                                             </div>
                                        </div>
                                   </div>
                              </a>
                              <% }) %>
                    </div>
                    <% } else { %>
                         <!-- Empty State -->
                         <div class="text-center py-12 bg-white rounded-xl shadow-sm">
                              <div class="max-w-md mx-auto px-4">
                                   <i class="fas fa-search text-gray-400 text-3xl mb-4"></i>
                                   <h3 class="text-lg font-semibold text-gray-900 mb-2">
                                        Aucun service disponible
                                   </h3>
                                   <p class="text-gray-500 mb-6">
                                        Aucun service n'est actuellement disponible dans cette cat√©gorie.
                                   </p>
                                   <a href="/services" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                        Voir tous les services
                                   </a>
                                   <a href="/dashboard/new-service" class="inline-flex items-center px-4 py-2 bg-yellow-500 text-white text-yellow-800 rounded-lg hover:bg-yellow-600 mt-2">
                                        Ajouter Votre Service
                                   </a>
                              </div>
                         </div>
                         <% } %>
                              <script>
                                   // Lazy Loading Images
                                   document.addEventListener('DOMContentLoaded', () => {
                                        const images = document.querySelectorAll('img[loading="lazy"]');
                                        const imageOptions = {
                                             threshold: 0.1,
                                             rootMargin: '50px'
                                        };

                                        const imageObserver = new IntersectionObserver((entries, observer) => {
                                             entries.forEach(entry => {
                                                  if (entry.isIntersecting) {
                                                       const img = entry.target;
                                                       img.classList.add('animate-fade-in');
                                                       observer.unobserve(img);
                                                  }
                                             });
                                        }, imageOptions);

                                        images.forEach(img => imageObserver.observe(img));
                                   });

                                   // Touch Feedback
                                   const cards = document.querySelectorAll('.sm\\:hidden');
                                   cards.forEach(card => {
                                        card.addEventListener('touchstart', () => {
                                             card.style.transform = 'scale(0.98)';
                                        });

                                        card.addEventListener('touchend', () => {
                                             card.style.transform = 'scale(1)';
                                        });
                                   });

                                   // Optional: Load More Functionality
                                   function showLoadingSkeleton() {
                                        document.getElementById('loadingSkeleton').style.display = 'grid';
                                   }

                                   function hideLoadingSkeleton() {
                                        document.getElementById('loadingSkeleton').style.display = 'none';
                                   }
                              </script>


          </div>


          <%- include('./include/footer') %>

               <!-- Styles -->
               <style>
                    /* Hide scrollbar but keep functionality */
                    .scrollbar-hide {
                         -ms-overflow-style: none;
                         scrollbar-width: none;
                    }

                    .scrollbar-hide::-webkit-scrollbar {
                         display: none;
                    }

                    /* Smooth scroll behavior */
                    #locationSlider {
                         -webkit-overflow-scrolling: touch;
                         scroll-behavior: smooth;
                    }

                    /* Animation for card hover */
                    .group:hover .group-hover\:scale-105 {
                         transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                         transition-duration: 500ms;
                    }
               </style>

               <!-- JavaScript -->
               <script>
                    document.addEventListener('DOMContentLoaded', function () {
                         const slider = document.getElementById('locationSlider');
                         let isScrolling = false;

                         // Handle scroll snap
                         slider.addEventListener('scroll', () => {
                              window.clearTimeout(isScrolling);
                              isScrolling = setTimeout(() => {
                                   const scrollLeft = slider.scrollLeft;
                                   const itemWidth = slider.querySelector('a').offsetWidth;
                                   const newScrollLeft = Math.round(scrollLeft / itemWidth) * itemWidth;

                                   slider.scrollTo({
                                        left: newScrollLeft,
                                        behavior: 'smooth'
                                   });
                              }, 150);
                         });

                         // Update dots indicator based on scroll position
                         function updateDots() {
                              const dots = document.querySelectorAll('.dot');
                              const scrollPercentage = slider.scrollLeft / (slider.scrollWidth - slider.clientWidth);
                              const activeDotIndex = Math.round(scrollPercentage * (dots.length - 1));

                              dots.forEach((dot, index) => {
                                   if (index === activeDotIndex) {
                                        dot.classList.add('bg-blue-500');
                                        dot.classList.remove('bg-gray-200');
                                   } else {
                                        dot.classList.remove('bg-blue-500');
                                        dot.classList.add('bg-gray-200');
                                   }
                              });
                         }

                         slider.addEventListener('scroll', updateDots);
                    });
               </script>
               <style>
                    /* Smooth transitions */
                    .group {
                         cursor: pointer;
                         transform: translateZ(0);
                    }

                    /* Line clamp fallback */
                    .line-clamp-1 {
                         display: -webkit-box;
                         -webkit-line-clamp: 1;
                         -webkit-box-orient: vertical;
                         overflow: hidden;
                    }

                    /* Touch-friendly sizing for mobile */
                    @media (max-width: 640px) {


                         .group:active {
                              transform: scale(0.98);
                         }
                    }

                    /* Image aspect ratio fix */
                    .aspect-square {
                         aspect-ratio: 1;
                    }
               </style>