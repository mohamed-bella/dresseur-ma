<!-- Main Navigation Container -->
<div x-data="{ 
    isScrolled: false,
    isMobileMenuOpen: false,
    isSearchOpen: false,
    showAuthModal: false,
    currentSearch: '',
    searchFocused: false
}" @scroll.window="isScrolled = (window.pageYOffset > 20)" class="relative">

     <!-- Main Navbar -->
     <nav class="fixed top-0 inset-x-0 z-50 bg-white border-b border-gray-200 transition-all duration-300" :class="{ 'shadow-md transform translate-y-0': isScrolled, 'transform -translate-y-1': !isScrolled }">
          <div class="max-w-7xl mx-auto">
               <div class="px-4 sm:px-6">
                    <!-- Desktop & Mobile Layout -->
                    <div class="flex items-center justify-between h-16">
                         <!-- Left Section: Logo & Hamburger -->
                         <div class="flex items-center gap-4">
                              <!-- Mobile Menu Button -->
                              <button @click="isMobileMenuOpen = true" class="lg:hidden -ml-2 p-3 rounded-xl hover:bg-gray-100 active:bg-gray-200 transition-all duration-200">
                                   <i class="fas fa-bars text-xl"></i>
                              </button>

                              <!-- Logo -->
                              <a href="/" class="flex items-center gap-3">
                                   <img src="https://ndressilik.s3.eu-north-1.amazonaws.com/users/67338636f84bd237e37a39a6/gallery/1731497935188_ndressilikLogoTopNavbar.png" alt="NDRESSILIK" class="h-10 w-auto">
                                   <span class="font-semibold text-2xl hidden sm:block">NDRESSILIK</span>
                              </a>
                         </div>

                         <!-- Center Section: Navigation Links (Desktop) -->
                         <div class="hidden lg:flex items-center gap-8">
                              <a href="/services" class="text-gray-600 hover:text-gray-900 font-medium transition-colors">Services</a>
                              <a href="/articles" class="text-gray-600 hover:text-gray-900 font-medium transition-colors">Articles</a>
                              <a href="/events" class="text-gray-600 hover:text-gray-900 font-medium transition-colors">Ã‰vÃ©nements</a>
                              <a href="/top-providers" class="text-gray-600 hover:text-gray-900 font-medium transition-colors">Top Prestataires</a>
                              <a href="/about" class="text-gray-600 hover:text-gray-900 font-medium transition-colors">Ã€ propos</a>
                              <a href="/contact" class="text-gray-600 hover:text-gray-900 font-medium transition-colors">Contact</a>
                         </div>

                         <!-- Right Section -->
                         <div class="flex items-center gap-4">
                              <!-- Search Button -->
                              <button @click="isSearchOpen = true" class="p-3 rounded-xl hover:bg-gray-100 transition-all duration-200">
                                   <i class="fas fa-search text-lg"></i>
                              </button>

                              <!-- Add Service Button -->
                              <% if (user) { %>
                                   <a href="/dashboard/new-service" class="group inline-flex items-center px-6 h-12 bg-orange-600 hover:bg-orange-700 
                                      text-white rounded-xl font-medium transition-all duration-200 transform hover:scale-105">
                                        <span class="mr-2">Ajouter un service</span>
                                        <i class="fas fa-plus transform group-hover:rotate-90 transition-transform duration-300"></i>
                                   </a>
                                   <% } else { %>
                                        <button @click="showAuthModal = true" class="group inline-flex items-center px-3 h-12 bg-blue-600 hover:bg-orange-700 
                                           text-white rounded-xl font-medium transition-all duration-200 transform hover:scale-105">
                                             <i class="fas fa-plus transform group-hover:rotate-90 transition-transform duration-300"></i>
                                             <span class="mr-2">Ajouter un service</span>
                                        </button>
                                        <% } %>

                                             <!-- User Menu -->
                                             <% if (user) { %>
                                                  <div class="relative" x-data="{ open: false }">
                                                       <button @click="open = !open" class="flex items-center gap-2 p-2 rounded-xl hover:bg-gray-100 transition-colors">
                                                            <img src="<%= user.profileImage || '/default-avatar.png' %>" alt="Profile" class="w-10 h-10 rounded-xl object-cover ring-2 ring-white">
                                                       </button>
                                                       <!-- User Dropdown here... -->
                                                  </div>
                                                  <% } %>
                         </div>
                    </div>
               </div>
          </div>
     </nav>

     <!-- Mobile Search Overlay -->
     <div x-show="isSearchOpen" x-cloak class="fixed inset-0 z-50 bg-white" @keydown.escape="isSearchOpen = false">
          <div class="p-4">
               <div class="flex items-center gap-4">
                    <button @click="isSearchOpen = false" class="p-3 rounded-xl hover:bg-gray-100 transition-colors">
                         <i class="fas fa-arrow-left text-lg"></i>
                    </button>
                    <form action="/search" method="get">
                         <div class="flex-1 relative">
                              <input name="q" type="search" placeholder="Rechercher un service..." class="w-full h-14 pl-14 pr-4 rounded-xl border-2 border-gray-200 
                                                      focus:border-orange-600 focus:outline-none transition-colors" x-model="currentSearch" autofocus>
                              <i class="fas fa-search text-gray-400 absolute left-5 top-1/2 -translate-y-1/2"></i>
                         </div>
                    </form>
               </div>
          </div>
     </div>

     <!-- Mobile Sidebar Menu -->
     <div x-show="isMobileMenuOpen" x-cloak class="fixed inset-0 z-50">
          <!-- Backdrop -->
          <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" @click="isMobileMenuOpen = false"></div>

          <!-- Sidebar -->
          <div class="fixed inset-y-0 right-0 w-[85%] max-w-sm bg-white shadow-xl 
                    transform transition-transform duration-300" :class="{ 'translate-x-0': isMobileMenuOpen, 'translate-x-full': !isMobileMenuOpen }">

               <!-- Sidebar Header -->
               <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                         <img src="https://ndressilik.s3.eu-north-1.amazonaws.com/users/67338636f84bd237e37a39a6/gallery/1731497935188_ndressilikLogoTopNavbar.png" alt="NDRESSILIK" class="h-8">
                         <button @click="isMobileMenuOpen = false" class="p-3 rounded-xl hover:bg-gray-100 transition-colors">
                              <i class="fas fa-times text-lg"></i>
                         </button>
                    </div>
               </div>

               <!-- Menu Items -->
               <div class="flex-1 overflow-y-auto py-6">
                    <a href="/services" class="flex items-center px-6 py-4 text-lg hover:bg-gray-50 transition-colors">
                         <i class="fas fa-concierge-bell w-8"></i>
                         <span>Services</span>
                    </a>
                    <a href="/articles" class="flex items-center px-6 py-4 text-lg hover:bg-gray-50 transition-colors">
                         <i class="fas fa-newspaper w-8"></i>
                         <span>Articles</span>
                    </a>
                    <a href="/events" class="flex items-center px-6 py-4 text-lg hover:bg-gray-50 transition-colors">
                         <i class="fas fa-calendar-alt w-8"></i>
                         <span>Ã‰vÃ©nements</span>
                    </a>
                    <a href="/top-providers" class="flex items-center px-6 py-4 text-lg hover:bg-gray-50 transition-colors">
                         <i class="fas fa-award w-8"></i>
                         <span>Top Prestataires</span>
                    </a>
                    <a href="/about" class="flex items-center px-6 py-4 text-lg hover:bg-gray-50 transition-colors">
                         <i class="fas fa-info-circle w-8"></i>
                         <span>Ã€ propos</span>
                    </a>
                    <a href="/contact" class="flex items-center px-6 py-4 text-lg hover:bg-gray-50 transition-colors">
                         <i class="fas fa-envelope w-8"></i>
                         <span>Contact</span>
                    </a>
               </div>

               <!-- Sidebar Footer -->
               <div class="border-t border-gray-200 p-6">
                    <% if (user) { %>
                         <div class="flex items-center gap-4 mb-6">
                              <img src="<%= user.profileImage || '/default-avatar.png' %>" alt="Profile" class="w-12 h-12 rounded-xl object-cover">
                              <div>
                                   <div class="font-medium text-lg">
                                        <%= user.displayName %>
                                   </div>
                                   <div class="text-gray-500">
                                        <%= user.email %>
                                   </div>
                              </div>
                         </div>
                         <a href="/dashboard" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-xl transition-colors">
                              <i class="fas fa-th-large mr-3"></i> Dashboard
                         </a>
                         <a href="/profile" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-xl transition-colors">
                              <i class="fas fa-user mr-3"></i> Profile
                         </a>
                         <a href="/logout" class="block px-4 py-3 text-red-600 hover:bg-red-50 rounded-xl transition-colors mt-2">
                              <i class="fas fa-sign-out-alt mr-3"></i> DÃ©connexion
                         </a>
                         <% } else { %>
                              <button @click="showAuthModal = true; isMobileMenuOpen = false" class="w-full px-6 py-4 bg-orange-600 text-white rounded-xl
                                   font-medium hover:bg-orange-700 transition-colors">
                                   <i class="fas fa-sign-in-alt mr-2"></i>
                                   Commencer
                              </button>
                              <% } %>
               </div>
          </div>
     </div>

     <!-- Auth Modal -->
     <div x-show="showAuthModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto" @keydown.escape="showAuthModal = false">
          <!-- Backdrop -->
          <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" @click="showAuthModal = false"></div>

          <!-- Modal Content -->
          <div class="relative min-h-screen flex items-center justify-center p-4">
               <div class="relative bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden">
                    <!-- Modal Header -->
                    <div class="p-8 text-center">
                         <!-- Close Button -->
                         <button @click="showAuthModal = false" class="absolute top-4 right-4 p-2 rounded-xl hover:bg-gray-100 transition-colors">
                              <i class="fas fa-times text-lg"></i>
                         </button>

                         <h2 class="text-2xl font-bold mb-2 font-arabic">Ø£Ø¶Ù Ø®Ø¯Ù…ØªÙƒ</h2>
                         <p class="text-gray-600 mb-2 font-arabic">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù…Ø¬ØªÙ…Ø¹ Ù…Ù‚Ø¯Ù…ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù„Ø¯ÙŠÙ†Ø§</p>
                         <p class="text-sm text-gray-500 mb-8 font-arabic">
                              Ù‚Ù… Ø¨Ø¹Ø±Ø¶ Ø®Ø¯Ù…Ø§ØªÙƒ ÙÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„Ø¹Ù†Ø§ÙŠØ© ÙˆØ§Ù„Ø¥ÙŠÙˆØ§Ø¡
                         </p>

                         <!-- Google Sign In Button -->
                         <a href="/auth/google" class="flex items-center justify-center gap-3 w-full px-6 py-4 
                              border-2 border-gray-200 rounded-xl text-gray-700 
                              hover:bg-gray-50 transition-colors">
                              <i class="fab fa-google text-lg"></i>
                              <span class="font-arabic">Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ø¬ÙˆØ¬Ù„</span>
                         </a>

                         <!-- Services List -->
                         <div class="mt-8 border-t border-gray-200 pt-6">
                              <p class="text-sm text-gray-600 mb-4 font-arabic">ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ‚Ø¯ÙŠÙ… Ø®Ø¯Ù…Ø§Øª:</p>
                              <div class="grid grid-cols-2 gap-4 text-sm">
                                   <div class="flex items-center gap-2 text-gray-700 p-3 rounded-xl hover:bg-gray-50">
                                        <span>ğŸ•</span>
                                        <span class="font-arabic">ØªØ¯Ø±ÙŠØ¨</span>
                                   </div>
                                   <div class="flex items-center gap-2 text-gray-700 p-3 rounded-xl hover:bg-gray-50">
                                        <span>âœ‚ï¸</span>
                                        <span class="font-arabic">ØªØ¬Ù…ÙŠÙ„</span>
                                   </div>
                                   <div class="flex items-center gap-2 text-gray-700 p-3 rounded-xl hover:bg-gray-50">
                                        <span>ğŸ </span>
                                        <span class="font-arabic">Ø¥ÙŠÙˆØ§Ø¡</span>
                                   </div>
                                   <div class="flex items-center gap-2 text-gray-700 p-3 rounded-xl hover:bg-gray-50">
                                        <span>ğŸš—</span>
                                        <span class="font-arabic">Ù†Ù‚Ù„</span>
                                   </div>
                              </div>
                         </div>
                    </div>
                    <!-- Cancel Button -->
                    <div class="p-6 bg-gray-50 border-t border-gray-200">
                         <button @click="showAuthModal = false" class="w-full flex items-center justify-center gap-2 px-6 py-3 
                                                       text-gray-700 rounded-xl hover:bg-gray-100 transition-colors">
                              <i class="fas fa-times"></i>
                              <span class="font-arabic">Ø¥Ù„ØºØ§Ø¡</span>
                         </button>
                    </div>
               </div>
          </div>
     </div>
</div>

<!-- Styles -->
<style>
     /* Arabic Font Import */
     @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');

     /* Custom Properties */
     :root {
          --transition-base: 0.2s ease-in-out;
          --transition-smooth: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
     }

     /* Base Styles */
     .font-arabic {
          font-family: 'Tajawal', sans-serif;
     }

     /* Animations */
     @keyframes slideIn {
          from {
               transform: translateY(-100%);
          }

          to {
               transform: translateY(0);
          }
     }

     @keyframes fadeIn {
          from {
               opacity: 0;
          }

          to {
               opacity: 1;
          }
     }

     @keyframes scaleIn {
          from {
               transform: scale(0.95);
               opacity: 0;
          }

          to {
               transform: scale(1);
               opacity: 1;
          }
     }

     /* Enhanced Mobile Styles */
     @media (max-width: 768px) {
          .mobile-touch-target {
               min-height: 48px;
               min-width: 48px;
          }

          .mobile-safe-bottom {
               padding-bottom: env(safe-area-inset-bottom);
          }
     }

     /* Interactive Elements */
     .interactive-hover {
          transition: all var(--transition-base);
     }

     .interactive-hover:hover {
          transform: translateY(-1px);
     }

     .interactive-hover:active {
          transform: translateY(0);
     }

     /* Custom Scrollbar */
     .custom-scrollbar::-webkit-scrollbar {
          width: 4px;
     }

     .custom-scrollbar::-webkit-scrollbar-track {
          background: transparent;
     }

     .custom-scrollbar::-webkit-scrollbar-thumb {
          background-color: rgba(0, 0, 0, 0.1);
          border-radius: 2px;
     }

     /* Soft Animations */
     .soft-enter {
          animation: fadeIn 0.3s ease-out;
     }

     .soft-slide {
          animation: slideIn 0.3s ease-out;
     }

     .soft-scale {
          animation: scaleIn 0.3s ease-out;
     }
</style>

<!-- Alpine.js Component Logic -->
<script>
     document.addEventListener('alpine:init', () => {
          Alpine.data('navbar', () => ({
               scrollThreshold: 20,
               lastScrollPosition: 0,
               isNavVisible: true,

               init() {
                    this.$watch('isMobileMenuOpen', (value) => {
                         document.body.style.overflow = value ? 'hidden' : '';
                    });

                    // Enhanced scroll handling
                    window.addEventListener('scroll', () => {
                         const currentScroll = window.pageYOffset;

                         if (currentScroll < this.lastScrollPosition) {
                              // Scrolling up
                              this.isNavVisible = true;
                         } else if (currentScroll > this.scrollThreshold) {
                              // Scrolling down past threshold
                              this.isNavVisible = false;
                         }

                         this.lastScrollPosition = currentScroll;
                    });

                    // Handle deep linking
                    const params = new URLSearchParams(window.location.search);
                    if (params.get('showAuth')) {
                         this.showAuthModal = true;
                    }
               },

               // Search handling with debounce
               searchTimeout: null,
               async handleSearch() {
                    if (this.searchTimeout) clearTimeout(this.searchTimeout);

                    this.searchTimeout = setTimeout(async () => {
                         if (this.currentSearch.length < 2) return;

                         this.isLoading = true;
                         try {
                              const response = await fetch(`/api/search?q=${encodeURIComponent(this.currentSearch)}`);
                              if (!response.ok) throw new Error('Search failed');
                              this.searchResults = await response.json();
                         } catch (error) {
                              console.error('Search error:', error);
                              this.searchResults = [];
                         } finally {
                              this.isLoading = false;
                         }
                    }, 300);
               },

               // Touch handling for mobile
               touchStart: null,
               handleTouchStart(event) {
                    this.touchStart = event.touches[0].clientY;
               },
               handleTouchMove(event) {
                    if (!this.touchStart) return;

                    const touchEnd = event.touches[0].clientY;
                    const diff = this.touchStart - touchEnd;

                    if (Math.abs(diff) > 50) {
                         this.isNavVisible = diff < 0;
                         this.touchStart = null;
                    }
               }
          }));
     });
</script>

<div class="mt-20"></div>